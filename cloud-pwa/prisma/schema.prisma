generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = "prisma+postgres://accelerate.prisma-data.net/?api_key=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqd3RfaWQiOjEsInNlY3VyZV9rZXkiOiJza180bzdleWkxamZad3VhY1NVNU9hU0oiLCJhcGlfa2V5IjoiMDFLR0hXNzVGMlM0TldGMENEWEJOWFNKWFQiLCJ0ZW5hbnRfaWQiOiJiZWQzZWJhMjE3N2MwNmFkNDZjMDM4YTZhMTUzMTMxYjlkNTk1M2FkOTlmMzQ5NTUzNjA1YTJhNjgwNWQyMTQ1IiwiaW50ZXJuYWxfc2VjcmV0IjoiYWM5Mjc0ZDctYzM4Mi00NmZlLTg1YzctYTAyOTY0MzEwZWQzIn0.9nGGQXjg1zNNM7LZRi-IjBcXMt55Erp36Aj3aHghrIU"
  directUrl = "postgres://bed3eba2177c06ad46c038a6a153131b9d5953ad99f349553605a2a6805d2145:sk_4o7eyi1jfZwuacSU5OaSJ@db.prisma.io:5432/postgres?sslmode=require"
}

model Store {
  id              String   @id @default(uuid())
  name            String
  url             String
  consumer_key    String
  consumer_secret String
  api_key         String?  // X-AutoDesign-Key for plugin
  orders          Order[]
  created_at      DateTime @default(now())
}

model Order {
  id            String      @id @default(uuid()) // Internal PWA ID
  woo_id        Int         // WooCommerce Order ID
  store_id      String
  store         Store       @relation(fields: [store_id], references: [id], onDelete: Cascade)
  customer_name String
  status        String      @default("PENDING")
  created_at    DateTime    @default(now()) // Original Woo order date
  updated_at    DateTime    @updatedAt
  items         OrderItem[]

  @@unique([woo_id, store_id])
}

model OrderItem {
  id               String  @id @default(uuid())
  order_id         String
  order            Order   @relation(fields: [order_id], references: [id], onDelete: Cascade)
  woo_item_id      Int
  product_name_raw String
  template_key     String?
  source_text      String? // Context for AI
  ai_data          String? // JSON results
  preview_url      String?
  agent_log        String?
  material         String?
  quantity         Int     @default(1)
  status           String  @default("PENDING")
}

model TemplateConfig {
  key      String @id
  manifest String
  mappings String? // JSON: { "Layer Name": "SYSTEM_KEY" }
  status   String @default("READY")
}

model Settings {
  key   String @id
  value String
}
